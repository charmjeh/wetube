ğŸ”¥ MONGO DB
===

**DEFFERENCE BETWEEN MONGO AND MONGOOSE**
`MONGO` : database
`MONGOOSE` : How we talk to the database using js
`SCHEMA` : an object that tells mongoose the spape of the data that we will save

**ì„¤ì¹˜** : 
ì»¤ë®¤ë‹ˆí‹° ì„œë²„ ë‹¤ìš´ ([ë‹¤ìš´ë¡œë“œ ë§í¬](https://www.mongodb.com/try/download/community))

**COMMAND**

```javascript
mongod // ëª½ê³ ë””ë¹„ ì¼œê¸°
mongo // ëª½ê³  ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì†

> show dbs // ë°ì´í„°ë² ì´ìŠ¤ ëª©ë¡
> use we-tube // we-tube db ì„ íƒ
> show collections // we-tubeì˜ ì½œë ‰ì…˜(ê´€ê³„í˜• DBì˜ í…Œì´ë¸”ê°™ì€ê²ƒ)ë“¤ í™•ì¸
> db.videos.find({}) // video collectionì˜ ë‚´ìš© í™•ì¸. {key: value} í˜•ì‹ìœ¼ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŒ.
> db.videos.remove({}) // videos ëª©ë¡ ì‚­ì œ

> exit
```

### DB ì„¤ì •
(*)  
    - `required` : í•´ë‹¹ ë‚´ìš©ì´ ì—†ìœ¼ë©´ ë³´ì—¬ì§ˆ ì—ëŸ¬ë©”ì‹œì§€  
    - `default` : ê¸°ë³¸ê°’ ì„¤ì • ê°€ëŠ¥  
    - `mongoose.Schema.Types.ObjectId` : ë‹¤ë¥¸ collection(ref: 'User')ì˜ ê°’ê³¼ ì—°ê²°í•  ìˆ˜ ìˆë‹¤.

```javascript
// db.js
import mongoose from 'mongoose'
import dotenv from 'dotenv' // keep secure db info
dotenv.config(); // ìë™ìœ¼ë¡œ .envíŒŒì¼ì•ˆì— ìˆëŠ” í•¨ìˆ˜ë“¤ì„ ë¶ˆëŸ¬ì˜´

mongoose.connect(
    process.env.MONGO_URL, // (urls:string, ..localhost:í¬íŠ¸ë²ˆí˜¸/ë°ì´í„°ë² ì´ìŠ¤ëª…, where is your database stored)
    {
        useNewUrlParser: true,
        useFindAndModify: false,
        useUnifiedTopology: true
    }
);

const db = mongoose.connection;

const handleOpen = () => console.log(`âœ…  Connected to DB`)
const handleError = (err) => console.log(`âŒ  Error on db connection: ${err}`)

db.once('open', handleOpen)
db.on('error', handleError)

// app.js
import mongoose from 'mongoose';
app.use(session({
    secret: process.env.COOKIE_SECRET,
    resave: true,
    saveUninitialized: false,
    store: new CookieStore({
        mongooseConnection: mongoose.connection
    })
}))

// modes/Video.js
import mongoose from 'mongoose';

const VideoSchema = new mongoose.Schema({
    fileUrl: {
        type: String,
        required: 'File URL is required' // (*)
    },
    description: String,
    createdAt: {
        type: Date,
        default: Date.now
    },
    creator: {
        type: mongoose.Schema.Types.ObjectId,
        ref: "User"
    }
});
const model = mongoose.model('Video', VideoSchema)
export default model;
```

ì„¤ì • í›„ ì•„ë˜ì™€ ê°™ì´ controllersì—ì„œ video collection ê²€ìƒ‰ ë° ìˆ˜ì •ì´ ê°€ëŠ¥í•˜ë‹¤.

```javascript
// controllers/videoControllers.js
import Video from "../models/Video";
export const postRegisterView = async (req, res) => {
    /**
        * Saves this document.
        * @param options options optional options
        * @param options.safe overrides schema's safe option
        * @param options.validateBeforeSave set to false to save without validating.
        * @param fn optional callback
        */
    save(options?: SaveOptions, fn?: (err: any, product: this) => void): Promise<this>;
    
const video = await Video.findById(req.params.id)
    video.views += 1;
    video.save();
}

// and also use like this...
await Video.create({
    fileUrl: path,
    title,
    description,
    creator: req.user.id
});
await Video.find({}).sort({_id: -1});
// findById: videoModelì—ì„œ í•´ë‹¹ idë¡œ ê²€ìƒ‰í•´ì„œ
// populate: ê·¸ videoë¥¼ ë§Œë“  creator ê°ì²´ë¥¼ í†µì§¸ë¡œ ê°€ì ¸ì˜¨ë‹¤.
// (video modelì˜ creatorëŠ” mongoose.Schema.Types.ObjectIdë¡œ Userí…Œì´ë¸”ê³¼ ì—°ê²°ë˜ì–´ìˆìŒ)
await Video.findById(id).populate('creator');
``` 
